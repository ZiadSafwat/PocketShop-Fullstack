<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-5 fw-bold text-body">
          <i class="fas fa-edit me-3 text-primary"></i>
          {{ languageService.translate('edit_product', translations) }}
        </h1>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-danger" (click)="deleteProduct()">
            <i class="fas fa-trash me-2"></i>
            {{ languageService.translate('delete_product', translations) }}
          </button>
          <a [routerLink]="['/products', productId()]" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>
            {{ languageService.translate('cancel', translations) }}
          </a>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading()" class="text-center py-5">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-body">{{ languageService.translate('loading', translations) }}</p>
      </div>

      <!-- Product Form -->
      <form *ngIf="!loading()" (ngSubmit)="onSubmit()" class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white py-3">
          <h5 class="mb-0">
            <i class="fas fa-info-circle me-2"></i>
            {{ languageService.translate('product_info', translations) }}
          </h5>
        </div>
        
        <div class="card-body p-4">
          <!-- Basic Information -->
          <div class="row g-3">
            <!-- English Title -->
            <div class="col-md-6">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('title_en', translations) }} *
              </label>
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="productData.title_en" 
                     name="title_en"
                     required>
            </div>

            <!-- Arabic Title -->
            <div class="col-md-6">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('title_ar', translations) }} *
              </label>
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="productData.title_ar" 
                     name="title_ar"
                     required
                     dir="rtl">
            </div>

            <!-- English Description -->
            <div class="col-12">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('description_en', translations) }}
              </label>
              <textarea class="form-control" 
                        rows="3"
                        [(ngModel)]="productData.description_en" 
                        name="description_en"></textarea>
            </div>

            <!-- Arabic Description -->
            <div class="col-12">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('description_ar', translations) }}
              </label>
              <textarea class="form-control" 
                        rows="3"
                        [(ngModel)]="productData.description_ar" 
                        name="description_ar"
                        dir="rtl"></textarea>
            </div>

            <!-- Price, Stock and Discount -->
            <div class="col-md-4">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('price', translations) }} *
              </label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" 
                       class="form-control" 
                       [(ngModel)]="productData.price" 
                       name="price"
                       min="0"
                       step="0.01"
                       required>
              </div>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('stock', translations) }} *
              </label>
              <input type="number" 
                     class="form-control" 
                     [(ngModel)]="productData.stock" 
                     name="stock"
                     min="0"
                     required>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('discount', translations) }}
              </label>
              <div class="input-group">
                <span class="input-group-text">%</span>
                <input type="number" 
                       class="form-control" 
                       [(ngModel)]="productData.discountPercentage" 
                       name="discountPercentage"
                       min="0"
                       max="100"
                       step="0.01">
              </div>
            </div>

            <!-- Category -->
            <div class="col-12">
              <label class="form-label fw-semibold text-body">
                {{ languageService.translate('category', translations) }} *
              </label>
              <select class="form-select" 
                      [(ngModel)]="productData.category" 
                      name="category"
                      multiple
                      required>
                <option value="" disabled>
                  {{ languageService.translate('select_category', translations) }}
                </option>
                <option *ngFor="let category of categories()" 
                        [value]="category.id"
                        class="text-body">
                  {{ languageService.language() === 'en' ? category.title.en : category.title.ar }}
                </option>
              </select>
              <small class="form-text text-body-secondary">
                {{ languageService.language() === 'en' ? 'Hold Ctrl/Cmd to select multiple categories' : 'اضغط على Ctrl/Cmd لاختيار أكثر من فئة' }}
              </small>
            </div>
          </div>

          <!-- Colors Section -->
          <div class="mt-4 pt-3 border-top">
            <h6 class="fw-semibold text-body mb-3">
              <i class="fas fa-palette me-2 text-primary"></i>
              {{ languageService.translate('colors', translations) }} *
            </h6>
            
            <div *ngIf="availableColors().length > 0; else loadingColors">
              <select class="form-select" 
                      [(ngModel)]="productData.color" 
                      name="colors"
                      multiple
                      required>
                <option *ngFor="let color of availableColors()"
                        [value]="languageService.language() === 'en' ? color : color"
                        class="text-body">
                  {{ languageService.language() === 'en' ? color : color }}
                </option>
              </select>
              <small class="form-text text-body-secondary">
                {{ languageService.language() === 'en' ? 'Hold Ctrl/Cmd to select multiple colors' : 'اضغط على Ctrl/Cmd لاختيار أكثر من لون' }}
              </small>
            </div>
            <ng-template #loadingColors>
              <div class="text-secondary">
                <i class="fas fa-spinner fa-spin me-2"></i>
                {{ languageService.translate('loading_data', translations) }}
              </div>
            </ng-template>
          </div>

          <!-- Sizes Section -->
          <div class="mt-4 pt-3 border-top">
            <h6 class="fw-semibold text-body mb-3">
              <i class="fas fa-ruler me-2 text-primary"></i>
              {{ languageService.translate('sizes', translations) }} *
            </h6>
            
            <div *ngIf="availableSizes().length > 0; else loadingSizes">
              <select class="form-select" 
                      [(ngModel)]="productData.size" 
                      name="sizes"
                      multiple
                      required>
                <option *ngFor="let size of availableSizes()" 
                        [value]="size"
                        class="text-body">
                  {{ size }}
                </option>
              </select>
              <small class="form-text text-body-secondary">
                {{ languageService.language() === 'en' ? 'Hold Ctrl/Cmd to select multiple sizes' : 'اضغط على Ctrl/Cmd لاختيار أكثر من مقاس' }}
              </small>
            </div>
            <ng-template #loadingSizes>
              <div class="text-secondary">
                <i class="fas fa-spinner fa-spin me-2"></i>
                {{ languageService.translate('loading_data', translations) }}
              </div>
            </ng-template>
          </div>

          <!-- Images Section -->
          <div class="mt-4 pt-3 border-top">
            <h6 class="fw-semibold text-body mb-3">
              <i class="fas fa-images me-2 text-primary"></i>
              {{ languageService.translate('images', translations) }} *
            </h6>
            
            <!-- Existing Images -->
            <div *ngIf="existingImages().length > 0" class="mb-4">
              <h6 class="fw-semibold text-body mb-3">
                {{ languageService.translate('existing_images', translations) }}
              </h6>
              <div class="row g-3">
                <div *ngFor="let image of existingImages(); let i = index" class="col-6 col-md-4 col-lg-3">
                  <div class="image-preview position-relative">
                    <img [src]="getImageUrl(image)" 
                         class="img-thumbnail w-100" 
                         style="height: 120px; object-fit: cover;"
                         alt="Existing product image">
                    <button type="button" 
                            class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1"
                            (click)="removeExistingImage(i)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- New Images -->
            <div>
              <h6 class="fw-semibold text-body mb-3">
                {{ languageService.translate('new_images', translations) }}
              </h6>
              
              <!-- File Input -->
              <div class="mb-3">
                <input type="file" 
                       class="form-control" 
                       (change)="onFileSelected($event)"
                       multiple
                       accept="image/*">
                <div class="form-text text-body-secondary">
                  {{ languageService.language() === 'en' ? 'Select multiple product images' : 'اختر عدة صور للمنتج' }}
                </div>
              </div>

              <!-- Image Previews -->
              <div class="row g-3" *ngIf="imagePreviews().length > 0">
                <div *ngFor="let preview of imagePreviews(); let i = index" class="col-6 col-md-4 col-lg-3">
                  <div class="image-preview position-relative">
                    <img [src]="preview" 
                         class="img-thumbnail w-100" 
                         style="height: 120px; object-fit: cover;"
                         alt="New product image preview">
                    <button type="button" 
                            class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1"
                            (click)="removeImage(i)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="card-footer bg-body-tertiary py-3">
          <button type="submit" 
                  class="btn btn-primary btn-lg w-100"
                  [disabled]="submitting()">
            <span *ngIf="!submitting()">
              <i class="fas fa-save me-2"></i>
              {{ languageService.translate('update', translations) }}
            </span>
            <span *ngIf="submitting()">
              <i class="fas fa-spinner fa-spin me-2"></i>
              {{ languageService.translate('submitting', translations) }}
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>